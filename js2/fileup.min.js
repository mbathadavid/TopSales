!function(u){var a={url:window.location.pathname+window.location.search,inputID:"",queueID:"",dropzoneID:"",files:[],fieldName:"filedata",extraFields:{},lang:"en",sizeLimit:0,filesLimit:0,method:"post",timeout:null,autostart:!1,templateFile:'<div id="fileup-[INPUT_ID]-[FILE_NUM]" class="fileup-file [TYPE]"><div class="fileup-preview"><img src="[PREVIEW_SRC]" alt="[NAME]"/></div><div class="fileup-container"><div class="fileup-description"><span class="fileup-name">[NAME]</span> (<span class="fileup-size">[SIZE_HUMAN]</span>)</div><div class="fileup-controls"><span class="fileup-remove" onclick="$.fileup(\'[INPUT_ID]\', \'remove\', \'[FILE_NUM]\');" title="[REMOVE]"></span><span class="fileup-upload" onclick="$.fileup(\'[INPUT_ID]\', \'upload\', \'[FILE_NUM]\');">[UPLOAD]</span><span class="fileup-abort" onclick="$.fileup(\'[INPUT_ID]\', \'abort\', \'[FILE_NUM]\');" style="display:none">[ABORT]</span></div><div class="fileup-result"></div><div class="fileup-progress"><div class="fileup-progress-bar"></div></div></div><div class="fileup-clear"></div></div>',onSelect:function(e){},onRemove:function(e,t,i){},onBeforeStart:function(e,t,i){},onBeforeRender:function(){},onAfterRender:function(){},onStart:function(e,t){},onStartSystem:function(e,t){var i=this.fileup.options,n=u("#fileup-"+i.inputID+"-"+e);n.find(".fileup-controls .fileup-upload").hide(),n.find(".fileup-controls .fileup-abort").show(),n.find(".fileup-result").removeClass("fileup-error").removeClass("fileup-success").text("")},onProgress:function(e,t,i){var n,r;event.lengthComputable&&(n=this.fileup.options,r=Math.ceil(t.loaded/t.total*100),u("#fileup-"+n.inputID+"-"+e+" .fileup-progress-bar").css("width",r+"%"))},onSuccess:function(e,t,i){},onError:function(e,t,i,n){},onErrorSystem:function(e,t,i){var n=this.fileup.options;switch(e){case"files_limit":var r=s[n.lang].errorFilesLimit;alert(r.replace(/%filesLimit%/g,n.filesLimit));break;case"size_limit":var l=m(n.sizeLimit);r=(r=(r=s[n.lang].errorSizeLimit).replace(/%sizeLimit%/g,l)).replace(/%fileName%/g,t.name),alert(r);break;case"file_type":r=s[n.lang].errorFileType;alert(r.replace(/%fileName%/g,t.name));break;case"bad_status":case"error_load":var o=u("#fileup-"+n.inputID+"-"+i);o.find(".fileup-controls .fileup-abort").hide(),o.find(".fileup-controls .fileup-upload").show(),o.find(".fileup-result").addClass("fileup-error").text(s[n.lang].error);break;case"old_browser":alert(s[n.lang].errorOldBrowser)}},onAbort:function(e,t){},onAbortSystem:function(e,t){var i=this.fileup.options,n=u("#fileup-"+i.inputID+"-"+e);n.find(".fileup-controls .fileup-abort").hide(),n.find(".fileup-controls .fileup-upload").show(),n.find(".fileup-result").removeClass("fileup-error").removeClass("fileup-success").text("")},onTimeout:function(e,t){},onTimeoutSystem:function(e,t){var i=this.fileup.options,n=u("#fileup-"+i.inputID+"-"+e);n.find(".fileup-controls .fileup-abort").hide(),n.find(".fileup-controls .fileup-upload").show(),n.find(".fileup-result").removeClass("fileup-error").removeClass("fileup-success").text("")},onFinish:function(e,t){},onSuccessSystem:function(e,t,i){var n=this.fileup.options,r=u("#fileup-"+n.inputID+"-"+t);r.find(".fileup-controls .fileup-abort").hide(),r.find(".fileup-controls .fileup-upload").hide(),r.find(".fileup-result").removeClass("fileup-error").addClass("fileup-success").text(s[n.lang].complete)},onDragOver:function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},onDragLeave:function(e){},onDragEnd:function(e){},onDragEnter:function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}},p={addEvent:function(e,t,i){var n=e.fileup.events[t]||[];n.push(i),e.fileup.events[t]=n},removeEvents:function(e,t){e.fileup.events[t]=[]},callEvent:function(e,t,i){var n,r=!0;if(e.fileup.events[t])for(var l=0;l<e.fileup.events[t].length;l++)"function"==typeof e.fileup.events[t][l]&&(n=i?e.fileup.events[t][l].apply(e,i):e.fileup.events[t][l].apply(e),r&&!1===n&&(r=!1));return r}},r={input:{},select:function(e){return p.addEvent(r.input,"select",e),r},remove:function(e){return p.addEvent(r.input,"remove",e),r},beforeStart:function(e){return p.addEvent(r.input,"beforeStart",e),r},start:function(e){return p.addEvent(r.input,"start",e),r},progress:function(e){return p.addEvent(r.input,"progress",e),r},success:function(e){return p.addEvent(r.input,"success",e),r},error:function(e){return p.addEvent(r.input,"error",e),r},abort:function(e){return p.addEvent(r.input,"abort",e),r},timeout:function(e){return p.addEvent(r.input,"timeout",e),r},dragOver:function(e){return p.addEvent(r.input,"dragOver",e),r},dragLeave:function(e){return p.addEvent(r.input,"dragLeave",e),r},dragEnd:function(e){return p.addEvent(r.input,"dragEnd",e),r},dragEnter:function(e){return p.addEvent(r.input,"dragEnter",e),r}},s={ru:{upload:"Загрузить",abort:"Остановить",remove:"Удалить",complete:"Готово",error:"Ошибка",errorFilesLimit:"Количество выбранных файлов превышает лимит (%filesLimit%)",errorSizeLimit:'Файл "%fileName%" превышает предельный размер (%sizeLimit%)',errorFileType:'Файл "%fileName%" является некорректным',errorOldBrowser:"Ваш браузер не может загружать файлы. Обновите его до последней версии"},en:{upload:"Upload",abort:"Abort",remove:"Remove",complete:"Complete",error:"Error",errorFilesLimit:"The number of selected files exceeds the limit (%filesLimit%)",errorSizeLimit:'File "%fileName%" exceeds the size limit (%sizeLimit%)',errorFileType:'File "%fileName%" is incorrect',errorOldBrowser:"Your browser can not upload files. Update to the latest version"}};function f(e){e.preventDefault(),e.stopPropagation();var t=e.target.fileup.input,i=t.fileup.options,n=e.target.files||e.dataTransfer.files;if(n.length){p.callEvent(t,"beforeRender");for(var r=0;r<n.length;r++){var l=n[r];if(0<i.sizeLimit&&v(l)>i.sizeLimit)p.callEvent(t,"error",["size_limit",l]);else{if(0<i.filesLimit&&Object.keys(n).length>=i.filesLimit){p.callEvent(t,"error",["files_limit",l]);break}if("string"==typeof t.accept){var o=t.accept;if(o&&/[^\w]+/.test(o)){var a=!1,s=o.split(",");if(0<s.length)for(var f=0;f<s.length;f++)if(s[f]=s[f].replace(/\s/g,""),new RegExp(s[f].replace("*",".*")).test(l.type)||new RegExp(s[f].replace(".",".*/")).test(l.type)){a=!0;break}if(!a){p.callEvent(t,"error",["file_type",l]);continue}}}!1!==p.callEvent(t,"select",[l])&&c(l,t)}}u(t).val(""),p.callEvent(t,"afterRender")}p.callEvent(t,"dragEnd",[e])}function d(){if(this.files.length){var e=this.fileup.options;if(!u(this).is("[multiple]")){if(!p.callEvent(this,"remove",["*","1",this.files[0]]))return void u(this).val("");u("#"+e.queueID).empty(),this.fileup.files={}}p.callEvent(this,"beforeRender");for(var t=0;t<this.files.length;t++){var i=this.files[t];if(0<e.sizeLimit&&v(i)>e.sizeLimit)p.callEvent(this,"error",["size_limit",i]);else{if(0<e.filesLimit&&Object.keys(this.fileup.files).length>=e.filesLimit){p.callEvent(this,"error",["files_limit",i]);break}if("string"==typeof this.accept){var n=this.accept;if(n&&/[^\w]+/.test(n)){var r=!1,l=n.split(",");if(0<l.length)for(var o=0;o<l.length;o++)if(l[o]=l[o].replace(/\s/g,""),new RegExp(l[o].replace("*",".*")).test(i.type)||new RegExp(l[o].replace(".",".*/")).test(i.type)){r=!0;break}if(!r){p.callEvent(this,"error",["file_type",i]);continue}}}!1!==p.callEvent(this,"select",[i])&&c(i,this)}}u(this).val(""),p.callEvent(this,"afterRender")}}function c(t,i){var n=i.fileup.options;if(window.XMLHttpRequest)var r=new("onload"in new XMLHttpRequest?XMLHttpRequest:XDomainRequest);else{if(!window.ActiveXObject)return void p.callEvent(i,"error",["old_browser",t]);try{r=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{r=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return void p.callEvent(i,"error",["old_browser",t])}}}var e,l=n.templateFile;l=(l=(l=(l=(l=(l=(l=(l=(l=l.replace(/\[INPUT_ID\]/g,n.inputID)).replace(/\[FILE_NUM\]/g,i.fileup.nextID)).replace(/\[NAME\]/g,(e=t).name||e.fileName)).replace(/\[MTYPE\]/g,t.type)).replace(/\[SIZE\]/g,v(t))).replace(/\[SIZE_HUMAN\]/g,m(v(t)))).replace(/\[UPLOAD\]/g,s[n.lang].upload)).replace(/\[REMOVE\]/g,s[n.lang].remove)).replace(/\[ABORT\]/g,s[n.lang].abort);var o,a={xhr:r,file:t,file_number:i.fileup.nextID,status:"stand_by"};i.fileup.files[i.fileup.nextID]=a,i.fileup.nextID++,"image/gif"===t.type||"image/png"===t.type||"image/jpg"===t.type||"image/jpeg"===t.type?"undefined"!=typeof FileReader?((o=new FileReader).onload=function(e){l=(l=l.replace(/\[PREVIEW_SRC\]/g,e.target.result)).replace(/\[TYPE\]/g,"fileup-image"),u("#"+n.queueID).append(l),n.autostart&&E(i,a)},o.readAsDataURL(t)):(l=(l=l.replace(/\[PREVIEW_SRC\]/g,"")).replace(/\[TYPE\]/g,"fileup-image fileup-no-preview"),u("#"+n.queueID).append(l),n.autostart&&E(i,a)):(l=(l=l.replace(/\[PREVIEW_SRC\]/g,"")).replace(/\[TYPE\]/g,"fileup-doc"),u("#"+n.queueID).append(l),n.autostart&&E(i,a))}function v(e){return e.size||e.fileSize}function m(e){var t="";return 1073741824<=e?t=(e/1073741824).toFixed(2)+" Gb":1048576<=e?t=(e/1048576).toFixed(2)+" Mb":1024<=e?t=(e/1024).toFixed(2)+" Kb":0<=e&&(t=e+" bytes"),t}function E(t,i){var e=t.fileup.options,n=i.file_number,r=i.file,l=i.xhr;if("number"==typeof e.timeout&&(l.timeout=e.timeout),l.onloadstart=function(){i.status="loading",p.callEvent(t,"start",[n,r])},l.upload.onprogress=function(e){p.callEvent(t,"progress",[n,e,r])},l.onload=function(){i.status="loaded",200===l.status?p.callEvent(t,"success",[l.responseText,n,r]):p.callEvent(t,"error",["bad_status",r,n,l.responseText])},l.onloadend=function(){p.callEvent(t,"finish",[n,r])},l.onabort=function(){i.status="stand_by",p.callEvent(t,"abort",[n,r])},l.ontimeout=function(){i.status="stand_by",p.callEvent(t,"timeout",[n,r])},l.onerror=function(e){i.status="stand_by",p.callEvent(t,"error",["error_load",r,n,e])},l.open(e.method,e.url,!0),l.setRequestHeader("Cache-Control","no-cache"),l.setRequestHeader("X-Requested-With","XMLHttpRequest"),p.callEvent(t,"beforeStart",[l,n,r]),void 0===window.FormData)return l.send(r);var o=new FormData;return o.append(e.fieldName,r),Object.keys(e.extraFields).length&&u.each(e.extraFields,function(e,t){o.append(e,t)}),l.send(o)}var l={upload:function(e,t){var i=document.getElementById(e);i&&"file"===i.type&&"object"==typeof i.fileup&&("*"===t?u.each(i.fileup.files,function(e,t){"stand_by"===t.status&&E(i,t)}):"object"==typeof i.fileup.files[t]&&E(i,i.fileup.files[t]))},remove:function(e,t){var i=document.getElementById(e);if(i&&"file"===i.type&&"object"==typeof i.fileup){i.fileup.options;var n=Object.keys(i.fileup.files).length;if("*"===t){if(!1===p.callEvent(i,"remove",["*",n]))return;i.fileup.files={},u("[id^=fileup-"+e+"-]").fadeOut("fast",function(){u(this).remove()})}else if("object"==typeof i.fileup.files[t]){if(!1===p.callEvent(i,"remove",[i.fileup.files[t],n,t]))return;delete i.fileup.files[t],u("#fileup-"+e+"-"+t).fadeOut("fast",function(){u(this).remove()})}}},removeEvents:function(e,t){var i=document.getElementById(e);i&&"file"===i.type&&"object"==typeof i.fileup&&p.removeEvents(i,t)},abort:function(e,t){var i=document.getElementById(e);i&&"file"===i.type&&"object"==typeof i.fileup&&("*"===t?u.each(i.fileup.files,function(e,t){t.xhr.abort()}):"object"==typeof i.fileup.files[t]&&i.fileup.files[t].xhr.abort())}};u.fileup=function(e,t,i){var n;if("object"==typeof e){if(!function(e){var t,i=u.extend(!1,a,e),n=document.getElementById(i.inputID);if(n&&"file"===n.type&&(!i.dropzoneID||(t=document.getElementById(i.dropzoneID))&&(t.addEventListener("dragover",function(e){p.callEvent(n,"dragOver",[e])}),t.addEventListener("dragleave",function(e){p.callEvent(n,"dragLeave",[e])}),t.addEventListener("dragenter",function(e){p.callEvent(n,"dragEnter",[e])}),t.addEventListener("drop",f),t.fileup={input:n}),n.fileup={files:{},nextID:0,options:i,events:{}},p.addEvent(n,"select",i.onSelect),p.addEvent(n,"remove",i.onRemove),p.addEvent(n,"beforeStart",i.onBeforeStart),p.addEvent(n,"beforeRender",i.onBeforeRender),p.addEvent(n,"afterRender",i.onAfterRender),p.addEvent(n,"start",i.onStartSystem),p.addEvent(n,"start",i.onStart),p.addEvent(n,"progress",i.onProgress),p.addEvent(n,"success",i.onSuccessSystem),p.addEvent(n,"success",i.onSuccess),p.addEvent(n,"error",i.onErrorSystem),p.addEvent(n,"error",i.onError),p.addEvent(n,"abort",i.onAbortSystem),p.addEvent(n,"abort",i.onAbort),p.addEvent(n,"timeout",i.onTimeoutSystem),p.addEvent(n,"timeout",i.onTimeout),p.addEvent(n,"dragOver",i.onDragOver),p.addEvent(n,"dragLeave",i.onDragLeave),p.addEvent(n,"dragEnd",i.onDragEnd),p.addEvent(n,"dragEnter",i.onDragEnter),u(n).on("change",d),0<i.files.length)){p.callEvent(n,"beforeRender");for(var r=0;r<i.files.length;r++){var l,o=i.templateFile;o=(o=(o=(o=(o=(o=(o=o.replace(/\[INPUT_ID\]/g,i.inputID)).replace(/\[FILE_NUM\]/g,n.fileup.nextID)).replace(/\[NAME\]/g,i.files[r].name)).replace(/\[SIZE_HUMAN\]/g,m(i.files[r].size))).replace(/\[UPLOAD\]/g,s[i.lang].upload)).replace(/\[REMOVE\]/g,s[i.lang].remove)).replace(/\[ABORT\]/g,s[i.lang].abort),n.fileup.files[n.fileup.nextID]={xhr:null,file:i.files[r],file_number:n.fileup.nextID,status:"loaded"},o=i.files[r].previewUrl?(o=o.replace(/\[PREVIEW_SRC\]/g,i.files[r].previewUrl)).replace(/\[TYPE\]/g,"fileup-image"):(o=o.replace(/\[PREVIEW_SRC\]/g,"")).replace(/\[TYPE\]/g,"fileup-doc"),u("#"+i.queueID).append(o).find(".fileup-progress, .fileup-result, .fileup-upload, .fileup-abort").remove(),!i.files[r].downloadUrl||(l=u("#fileup-"+i.inputID+"-"+n.fileup.nextID).find(".fileup-name"))[0]&&l.replaceWith('<a href="'+i.files[r].downloadUrl+'" class="fileup-name" download="'+i.files[r].name+'">'+i.files[r].name+"</a>"),n.fileup.nextID++}p.callEvent(n,"afterRender")}}(e),(n=document.getElementById(e.inputID))&&"file"===n.type&&"object"==typeof n.fileup)return r.input=n,r}else if("string"==typeof e&&"string"==typeof t&&"function"==typeof l[t])l[t](e,i);else if("string"==typeof e&&void 0===t&&void 0===i){if((n=document.getElementById(e))&&"file"===n.type&&"object"==typeof n.fileup)return r.input=n,r}else u.error("Unknown method "+e)}}(jQuery);